<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¿ƒæƒ…ä¸æ•…äº‹</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#ffb6c1,#ffc0cb);
  margin:0; padding:0;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding-top:30px;
}
h1 { color:#e75480; text-align:center; }
.box {
  background:white;
  padding:20px;
  border-radius:15px;
  box-shadow:0 4px 15px rgba(0,0,0,0.1);
  width:90%;
  max-width:400px;
  margin-bottom:20px;
}
input,textarea,button { width:100%; margin:10px 0; padding:10px; border-radius:5px; border:1px solid #ddd; box-sizing:border-box; }
button { background:#e75480; color:white; font-weight:bold; cursor:pointer; transition:0.3s; }
button:hover { background:#d0426f; }
#posts .post { background:white; padding:15px; margin-bottom:15px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.05); }
#posts img,#posts video,#posts audio { max-width:100%; margin-top:10px; border-radius:8px; }
#userInfo { text-align:center; margin-bottom:15px; }
#logoutBtn { width:auto; padding:5px 15px; font-size:0.9em; }
</style>
</head>
<body>

<h1>å¿ƒæƒ…ä¸æ•…äº‹ ğŸ’Œ</h1>

<!-- ç™»å½•æ¡†ï¼Œåªæ˜¾ç¤ºç»™ç®¡ç†å‘˜ -->
<div class="box" id="loginBox">
  <h2>ç®¡ç†å‘˜ç™»å½•</h2>
  <input type="email" id="email" placeholder="é‚®ç®±">
  <input type="password" id="password" placeholder="å¯†ç ">
  <button id="loginBtn">ç™»å½•</button>
</div>

<!-- ä¸Šä¼ åŒºï¼Œåªæ˜¾ç¤ºç»™ç®¡ç†å‘˜ -->
<div class="box" id="uploadBox" style="display:none;">
  <div id="userInfo"></div>
  <button id="logoutBtn">ç™»å‡º</button>
  <h2>ä¸Šä¼ å†…å®¹</h2>
  <textarea id="text" placeholder="å†™ä¸‹ä½ çš„å¿ƒæƒ…..."></textarea>
  <input type="file" id="file">
  <button id="uploadBtn">ä¸Šä¼ </button>
</div>

<!-- è®¿å®¢å’Œç®¡ç†å‘˜éƒ½èƒ½çœ‹åˆ°çš„å†…å®¹åŒº -->
<div id="posts" class="box"></div>

<!-- Firebase v8 SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
// ====== Firebase é…ç½® ======
const firebaseConfig = {
  apiKey: "AIzaSyANMqEFLff9GIXoSoruEFgiWmgEeXJCLgA",
  authDomain: "xiaoli-298e6.firebaseapp.com",
  projectId: "xiaoli-298e6",
  storageBucket: "xiaoli-298e6.firebasestorage.app",
  messagingSenderId: "601841061193",
  appId: "1:601841061193:web:027c46363feba924669e98"
};
const app = firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const storage = firebase.storage();
const db = firebase.firestore();

// ====== è‡ªåŠ¨åŠ è½½å†…å®¹ç»™è®¿å®¢ ======
loadPosts();

// ====== ç™»å½•åŠŸèƒ½ ======
document.getElementById("loginBtn").addEventListener("click", ()=>{
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  
  auth.signInWithEmailAndPassword(email,password)
    .then(()=> {
      alert("ç™»å½•æˆåŠŸï¼");
      document.getElementById("loginBox").style.display="none";
      document.getElementById("uploadBox").style.display="block";
      document.getElementById("userInfo").innerText = "å½“å‰ç®¡ç†å‘˜ï¼š" + auth.currentUser.email;
      loadPosts(); // é‡æ–°åŠ è½½å†…å®¹
    })
    .catch(err=>{
      alert("ç™»å½•å¤±è´¥ï¼š" + err.message);
    });
});

// ====== ç™»å‡ºåŠŸèƒ½ ======
document.getElementById("logoutBtn").addEventListener("click", ()=>{
  auth.signOut().then(()=>{
    alert("å·²ç™»å‡º");
    document.getElementById("loginBox").style.display="block";
    document.getElementById("uploadBox").style.display="none";
    document.getElementById("email").value="";
    document.getElementById("password").value="";
  });
});

// ====== ä¸Šä¼ å†…å®¹ ======
async function uploadContent(){
  if(!auth.currentUser){ alert("è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦å·"); return; }

  const text = document.getElementById("text").value;
  const file = document.getElementById("file").files[0];
  let fileUrl = "";

  if(file){
    const storageRef = storage.ref('uploads/'+Date.now()+"_"+file.name);
    await storageRef.put(file);
    fileUrl = await storageRef.getDownloadURL();
  }

  await db.collection('posts').add({
    text:text,
    fileUrl:fileUrl,
    time:new Date().toISOString()
  });

  document.getElementById("text").value="";
  document.getElementById("file").value="";
  loadPosts();
}

// ====== æ˜¾ç¤ºå†…å®¹ ======
async function loadPosts(){
  const postsDiv = document.getElementById("posts");
  postsDiv.innerHTML="";
  const snapshot = await db.collection('posts').orderBy("time","desc").get();
  snapshot.forEach(doc=>{
    const data = doc.data();
    const div = document.createElement("div");
    div.className="post";
    div.innerHTML=`<p>${data.text}</p >`;
    if(data.fileUrl){
      if(data.fileUrl.match(/\.(jpg|png|gif)$/i)) div.innerHTML+=`< img src="${data.fileUrl}">`;
      else if(data.fileUrl.match(/\.(mp4|webm)$/i)) div.innerHTML+=`<video src="${data.fileUrl}" controls></video>`;
      else if(data.fileUrl.match(/\.(mp3|wav)$/i)) div.innerHTML+=`<audio src="${data.fileUrl}" controls></audio>`;
    }
    div.innerHTML+=`<small>${new Date(data.time).toLocaleString()}</small>`;
    postsDiv.appendChild(div);
  });
}

// ====== ç»‘å®šä¸Šä¼ æŒ‰é’® ======
document.getElementById("uploadBtn").addEventListener("click",uploadContent);
</script>

</body>
</html>
